<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <script src="https://www.w3schools.com/lib/w3.js"></script>
        <title></title>
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet"    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.css">
    </head>
    <body>
            <!--  Section1 -->
            <div    class="Section1">
                <div class="Section1Title">institute of database developers</div>
                <div  class="Section1Paragraph">

                    IODD members have demonstrated expertise in one or more areas of database analysis, design, implementation, management and maintenance.
                    <br><br>
                    IODD members serve as advisors to other members and their companies about the constantly changing database issues.
                    <div id="WelcomeBanner"></div>
                </div>
            </div>
            <!-- END  Section1 -->

            <script type="module">

//              console.log( "inc-section1.html[1]  Loading module script" )                   // .(30505.03.3 RAM Causes import to fail)
//              debugger 

       import { setAPI_URL, setHTML } from '../assets/mjs/formr_utility-fns_u1.07.mjs'         // .(30415.02.1 RAM Avoid CORS error).(30430.03.1).(30505.01.1 RJS Import here)

                console.log( "inc-section1.html[1]  Loading module script" )                   // .(30505.03.4 RAM Must be after import)
                debugger 

          await setAPI_URL( )   
//          var aAPI_URL = "http://localhost:3012"                                             // .(30412.03.1 RAM Set window.aAPI_URL ).(30505.01.2 RJS Use here)
//              window.aAPI_URL = aAPI_URL                                                     // .(30412.03.1 RAM Set window.aAPI_URL ).(30505.01.2 RJS Use here)

                console.log( "inc-section1.html[2]  Module script loaded" )    
            </script>
            <script type="module">

                console.log( "inc-section1.html[3]  Loading regular script" )    
                debugger 

//         $(document).ready( function() { ... }                               // jQuery method 1 
//         $(document).ready( onReady )                                        // jQuery method 2 
             document.addEventListener( 'readystatechange', function(event) {  // Browser method
               switch(event.target.readyState) {
                 case 'loading'    : console.log( "inc-section1.html[4]  ReadyState: Loading" );            break; 
                 case 'interactive': console.log( "inc-section1.html[5]  ReadyState: Ready?"  );            break; 
                 case 'complete'   : console.log( "inc-section1.html[6]  ReadyState: Complete"); onReady(); break;  
                 }
             }); 

       function onReady() {
             // alert ("Id = " + id)
//              debugger 

            var c  = document.cookie;  // Get cookie again, since it is not globally defined 
            var n  = c.indexOf("=")
            var id = (n > 0) ? parseInt(c.substring(n + 1)) : 0 

            var aDB_Server = typeof(aAPI_URL) == 'undefined' ? 'undefined' : aAPI_URL
                console.log( `inc-section1.html[7]  Fetching data from: '${aDB_Server}?id=${ id }'` )    

                var pWelcome = document.getElementById( "WelcomeBanner" )

                fetch( `${aAPI_URL}/members?id=${ id }` )
        //      fetch( `http://localhost:3013/members?id=${ id }` )

 //                .then( ( res  ) => res.json() ) // return not needed 
                   .then( ( res  ) => {            // return required in {} block  
                     return res.json( ) 
                            } )
                   .then( ( json ) => {  
                        var aHTML  = fmtWelcome( json )
                            pWelcome.innerHTML = aHTML 
                            }) 
                   .catch(( err  ) => alert ( `inc-section1.html[8]  *** ${err.message}` ));                     

                   function fmtWelcome ( pJSON ) {
                        if (pJSON.warning) { 
                        var aHTML =  pJSON.warning
                        } else { 
                        if (pJSON.members.length == 0) { 
                        var aHTML = ` ** No member found for id = ${ id }`
                        } else {    
                        var aHTML = "welcome "      + pJSON.members[0].FullName
                            aHTML =  aHTML + "<h3>" + pJSON.members[0].Company + "</h3>"
                          } } 
                     return aHTML
                        } // eof fmtWelcome  

                        console.log( "inc-section.html[9]  End of onReady"  )                              // .(30423.03.4)
                } // eof onReady 
                console.log( "inc-section1.html[10] Regular script loaded"  )                              // .(30423.03.4)

             </script>
    </body>
</html>
